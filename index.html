<!DOCTYPE html>
<html lang="th">
<head>
┬а <meta charset="UTF-8"/>
┬а <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
┬а <title>Bakery Moon Sweet</title>

┬а <script src="https://cdn.tailwindcss.com"></script>
┬а <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
┬а <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
┬а <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-amber-50">
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect} = React;

function useLocal(key,init){
┬а const [val,setVal]=useState(()=>JSON.parse(localStorage.getItem(key)||'null')??init);
┬а useEffect(()=>localStorage.setItem(key,JSON.stringify(val)),[key,val]);
┬а return [val,setVal];
}

// ---------------- MOCK DATA -----------------
const SAMPLE_PRODUCTS = [
┬а {id:'1',name:'Croissant',price:60,category:'Pastry',desc:'Buttery flaky croissant',rating:4.5, image:'https://images.unsplash.com/photo-1567620905732-2d1dc7efbdab?q=80&w=1974&auto=format&fit=crop'},
┬а {id:'2',name:'Chocolate Cake',price:120,category:'Cake',desc:'Rich chocolate sponge with ganache',rating:5, image:'https://images.unsplash.com/photo-1578985545063-6f6f96ac3383?q=80&w=1974&auto=format&fit=crop'},
┬а {id:'3',name:'Cappuccino',price:80,category:'Beverage',desc:'Espresso with steamed milk',rating:4.2, image:'https://images.unsplash.com/photo-1541167710266-9b4344c80321?q=80&w=1974&auto=format&fit=crop'},
┬а {id:'4',name:'Macaron',price:30,category:'Pastry',desc:'Sweet meringue-based confection',rating:4.8, image:'https://images.unsplash.com/photo-1627889104193-4a1715450e18?q=80&w=1974&auto=format&fit=crop'},
┬а {id:'5',name:'Blueberry Muffin',price:50,category:'Pastry',desc:'Moist muffin with fresh blueberries',rating:4.3, image:'https://images.unsplash.com/photo-1621245037520-4e314643ce4e?q=80&w=1974&auto=format&fit=crop'}
];

const SAMPLE_REVIEWS = [
┬а {id: 'r1', productId: '1', rating: 5, comment: 'р╕нр╕гр╣Ир╕нр╕вр╕бр╕▓р╕Бр╣Ар╕ер╕вр╕Др╣Ир╕░', user: 'Jane Doe'},
┬а {id: 'r2', productId: '1', rating: 4, comment: 'р╕Бр╕гр╕нр╕Ър╕Щр╕нр╕Бр╕Щр╕╕р╣Ир╕бр╣Гр╕Щ', user: 'John Smith'}
];

// --------------- Components -----------------
function Header({cartCount,user,onNav,onCart}){
┬а return (
┬а ┬а <header className="bg-amber-100 border-b p-4 flex justify-between items-center">
┬а ┬а ┬а <h1 className="font-bold text-xl">Bakery Moon Sweet</h1>
┬а ┬а ┬а <div className="flex gap-4 items-center">
┬а ┬а ┬а ┬а <button onClick={()=>onNav('home')}>Home</button>
┬а ┬а ┬а ┬а <button onClick={()=>onNav('menu')}>Menu</button>
┬а ┬а ┬а ┬а <button onClick={()=>onNav('profile')}>Profile</button>
┬а ┬а ┬а ┬а <button onClick={()=>onNav('admin')}>Admin</button>
┬а ┬а ┬а ┬а <button className="bg-amber-600 text-white px-3 py-1 rounded" onClick={onCart}>Cart ({cartCount})</button>
┬а ┬а ┬а ┬а <span className="text-sm text-gray-700">{user ? `Hi, ${user}` : ''}</span>
┬а ┬а ┬а </div>
┬а ┬а </header>
┬а );
}

function SearchBar({onChange}){
┬а return (
┬а ┬а <input
┬а ┬а ┬а className="border p-2 w-full rounded mb-4"
┬а ┬а ┬а placeholder="р╕Др╣Йр╕Щр╕лр╕▓р╕кр╕┤р╕Щр╕Др╣Йр╕▓..."
┬а ┬а ┬а onChange={e=>onChange(e.target.value)}
┬а ┬а />
┬а );
}

function ProductCard({p,onAdd,onFav,favs,onReview}){
┬а const fav = favs.includes(p.id);
┬а return (
┬а ┬а <div className="border rounded-lg p-4 flex flex-col shadow-sm hover:shadow-lg transition-shadow bg-white">
┬а ┬а ┬а {p.image && <img src={p.image} alt={p.name} className="w-full h-32 object-cover rounded-md mb-2"/>}
┬а ┬а ┬а <div className="flex justify-between">
┬а ┬а ┬а ┬а <div className="font-semibold text-lg">{p.name}</div>
┬а ┬а ┬а ┬а <button onClick={()=>onFav(p.id)}>{fav?'тЭдя╕П':'ЁЯдН'}</button>
┬а ┬а ┬а </div>
┬а ┬а ┬а <div className="text-xs text-gray-600">{p.category}</div>
┬а ┬а ┬а <div className="mt-1 text-sm">{p.desc}</div>
┬а ┬а ┬а <div className="mt-1 text-yellow-600 text-sm">тнР {p.rating.toFixed(1)}</div>
┬а ┬а ┬а <div className="flex justify-between mt-3 items-center">
┬а ┬а ┬а ┬а <div className="font-bold text-lg">р╕┐{p.price}</div>
┬а ┬а ┬а ┬а <button onClick={()=>onAdd(p)} className="bg-amber-600 text-white px-2 py-1 rounded">Add</button>
┬а ┬а ┬а </div>
┬а ┬а ┬а <button onClick={()=>onReview(p)} className="text-xs mt-1 underline">р╕гр╕╡р╕зр╕┤р╕з</button>
┬а ┬а </div>
┬а );
}

function Home({products, onAdd, onFav, favs, onReview}) {
┬а ┬а const featured = products.slice(0, 4);
┬а ┬а return (
┬а ┬а ┬а ┬а <div className="p-4">
┬а ┬а ┬а ┬а ┬а ┬а <div className="relative h-64 bg-cover bg-center rounded-lg shadow-lg" style={{backgroundImage: "url('https://images.unsplash.com/photo-1542826189-9a706b8720ca?q=80&w=1974&auto=format&fit=crop')"}}>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div className="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center rounded-lg">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 className="text-white text-4xl font-bold drop-shadow-lg text-center">р╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ър╕кр╕╣р╣И Bakery Moon Sweet</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div className="mt-8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 className="font-bold text-2xl mb-4 text-center text-amber-800">р╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Бр╕Щр╕░р╕Щр╕│</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div className="grid md:grid-cols-4 gap-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а {featured.map(p => <ProductCard key={p.id} p={p} onAdd={onAdd} onFav={onFav} favs={favs} onReview={onReview}/>)}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div className="mt-8 bg-amber-200 p-6 rounded-lg shadow-md text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 className="font-bold text-2xl text-amber-800">р╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕Юр╕┤р╣Ар╕ир╕й!</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p className="mt-2 text-amber-700 text-lg">р╕гр╕▒р╕Ър╕кр╣Ир╕зр╕Щр╕ер╕Ф 10% р╣Ар╕бр╕╖р╣Ир╕нр╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╕Др╕гр╕Ъ 500 р╕Ър╕▓р╕Ч</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p className="font-semibold text-amber-900 mt-1">р╣Гр╕Кр╣Йр╣Вр╕Др╣Йр╕Ф: SWEET10</p>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а <div className="mt-8 text-center text-gray-700">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 className="font-bold text-2xl text-amber-800">р╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Бр╕▒р╕Ър╣Ар╕гр╕▓</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p className="mt-2 text-lg">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╣Ар╕гр╕▓р╕нр╕Ър╕Вр╕Щр╕бр╕Фр╣Йр╕зр╕вр╕Др╕зр╕▓р╕бр╕гр╕▒р╕Бр╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╣Гр╕кр╣Ир╣Гр╕Ир╕Чр╕╕р╕Бр╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╣Ар╕Юр╕╖р╣Ир╕нр╕бр╕нр╕Ър╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╣Гр╕лр╣Йр╕Бр╕▒р╕Ър╕Чр╕╕р╕Бр╕Др╕Щр╕Ьр╣Ир╕▓р╕Щр╕гр╕кр╕Кр╕▓р╕Хр╕┤р╕Чр╕╡р╣Ир╕лр╕нр╕бр╕лр╕зр╕▓р╕Щр╣Бр╕ер╕░р╕Щр╕╕р╣Ир╕бр╕ер╕░р╕бр╕╕р╕Щ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕бр╕▓р╕гр╣Ир╕зр╕бр╣Бр╕Ър╣Ир╕Зр╕Ыр╕▒р╕Щр╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓р╕Фр╕╡р╣Ж р╕Бр╕▒р╕Ър╣Ар╕Ър╣Ар╕Бр╕нр╕гр╕╡р╣Ир╕Вр╕нр╕Зр╣Ар╕гр╕▓р╕кр╕┤р╕Др╕гр╕▒р╕Ъ/р╕Др╣Ир╕░!
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </p>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </div>
┬а ┬а );
}

function Menu({products,onAdd,onFav,favs,onReview}){
┬а const [filter,setFilter]=useState('');
┬а const [search,setSearch]=useState('');
┬а const cats=['All',...new Set(products.map(p=>p.category))];
┬а const shown = products.filter(p=>
┬а ┬а (filter===''||filter==='All'||p.category===filter) &&
┬а ┬а p.name.toLowerCase().includes(search.toLowerCase())
┬а );
┬а return (
┬а ┬а <div className="p-4">
┬а ┬а ┬а <SearchBar onChange={setSearch}/>
┬а ┬а ┬а <select value={filter} onChange={e=>setFilter(e.target.value)} className="border p-1 mb-4">
┬а ┬а ┬а ┬а {cats.map(c=><option key={c}>{c}</option>)}
┬а ┬а ┬а </select>
┬а ┬а ┬а <div className="grid md:grid-cols-3 gap-4">
┬а ┬а ┬а ┬а {shown.map(p=><ProductCard key={p.id} p={p} onAdd={onAdd} onFav={onFav} favs={favs} onReview={onReview}/>)}
┬а ┬а ┬а </div>
┬а ┬а </div>
┬а );
}

function Cart({items,onQty,onRemove,onCheckout,coupon,onCoupon,onClose}){
┬а const subtotal = items.reduce((s,i)=>s+i.price*i.qty,0);
┬а const discount = coupon==='BAKE10'? subtotal*0.1 : 0;
┬а const total = subtotal - discount;
┬а return (
┬а ┬а <div className="fixed top-20 right-4 w-80 bg-white border p-4 rounded shadow z-50">
┬а ┬а ┬а <div className="flex justify-between mb-2">
┬а ┬а ┬а ┬а <h3 className="font-semibold">Cart</h3>
┬а ┬а ┬а ┬а <button onClick={onClose}>X</button>
┬а ┬а ┬а </div>
┬а ┬а ┬а {items.map(i=>
┬а ┬а ┬а ┬а <div key={i.id} className="flex justify-between mb-2">
┬а ┬а ┬а ┬а ┬а <span>{i.name}</span>
┬а ┬а ┬а ┬а ┬а <div className="flex gap-1 items-center">
┬а ┬а ┬а ┬а ┬а ┬а <button onClick={()=>onQty(i.id,i.qty-1)}>-</button>
┬а ┬а ┬а ┬а ┬а ┬а {i.qty}
┬а ┬а ┬а ┬а ┬а ┬а <button onClick={()=>onQty(i.id,i.qty+1)}>+</button>
┬а ┬а ┬а ┬а ┬а ┬а <button onClick={()=>onRemove(i.id)} className="text-red-500">x</button>
┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а )}
┬а ┬а ┬а <input className="border p-1 w-full mb-2" placeholder="р╣Гр╕кр╣Ир╕Др╕╣р╕Ыр╕нр╕З" value={coupon} onChange={e=>onCoupon(e.target.value)}/>
┬а ┬а ┬а <div>Subtotal: р╕┐{subtotal}</div>
┬а ┬а ┬а {discount>0 && <div className="text-green-600">Discount: -р╕┐{discount}</div>}
┬а ┬а ┬а <div className="font-bold">Total: р╕┐{total}</div>
┬а ┬а ┬а <button className="w-full bg-amber-600 text-white py-1 mt-2 rounded" onClick={()=>onCheckout(total)}>Checkout</button>
┬а ┬а </div>
┬а );
}

function Profile({orders,favs, onCancelOrder}){
┬а return (
┬а ┬а <div className="p-4">
┬а ┬а ┬а <h2 className="font-bold text-lg mb-2">Profile</h2>
┬а ┬а ┬а <h3 className="font-semibold mt-2">Favorites</h3>
┬а ┬а ┬а <ul className="list-disc ml-5">
┬а ┬а ┬а ┬а {favs.length?favs.map(f=><li key={f}>{f}</li>):<li>р╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Вр╕Ыр╕гр╕Ф</li>}
┬а ┬а ┬а </ul>
┬а ┬а ┬а <h3 className="font-semibold mt-4">Orders</h3>
┬а ┬а ┬а {orders.length===0 && <p>р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕нр╕нр╣Ар╕Фр╕нр╕гр╣М</p>}
┬а ┬а ┬а {orders.map(o=>(
┬а ┬а ┬а ┬а <div key={o.id} className="border p-2 my-1 flex justify-between items-center">
┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а <div>#{o.id} тАв р╕┐{o.total} тАв {o.method}</div>
┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а <button
┬а ┬а ┬а ┬а ┬а ┬а onClick={() => onCancelOrder(o.id)}
┬а ┬а ┬а ┬а ┬а ┬а className="bg-red-500 text-white text-xs px-2 py-1 rounded hover:bg-red-600"
┬а ┬а ┬а ┬а ┬а >
┬а ┬а ┬а ┬а ┬а ┬а р╕вр╕Бр╣Ар╕ер╕┤р╕Б
┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ))}
┬а ┬а </div>
┬а );
}

function Admin({products,onAdd,onDel}){
┬а const [form,setForm]=useState({name:'',price:'',category:'',desc:''});
┬а return (
┬а ┬а <div className="p-4">
┬а ┬а ┬а <h2 className="font-bold text-lg mb-2">Admin Panel</h2>
┬а ┬а ┬а <div className="border p-3 mb-4 rounded">
┬а ┬а ┬а ┬а <input className="border p-1 mr-1" placeholder="Name" value={form.name} onChange={e=>setForm({...form,name:e.target.value})}/>
┬а ┬а ┬а ┬а <input className="border p-1 mr-1 w-20" placeholder="Price" value={form.price} onChange={e=>setForm({...form,price:e.target.value})}/>
┬а ┬а ┬а ┬а <input className="border p-1 mr-1" placeholder="Category" value={form.category} onChange={e=>setForm({...form,category:e.target.value})}/>
┬а ┬а ┬а ┬а <input className="border p-1 mr-1" placeholder="Desc" value={form.desc} onChange={e=>setForm({...form,desc:e.target.value})}/>
┬а ┬а ┬а ┬а <button className="bg-green-500 text-white px-2 py-1 rounded" onClick={()=>{
┬а ┬а ┬а ┬а ┬а if(form.name&&form.price){
┬а ┬а ┬а ┬а ┬а ┬а onAdd({...form,price:Number(form.price),id:Date.now().toString(),rating:0});
┬а ┬а ┬а ┬а ┬а ┬а setForm({name:'',price:'',category:'',desc:''});
┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }}>Add</button>
┬а ┬а ┬а </div>
┬а ┬а ┬а <h3 className="font-semibold">Current Products</h3>
┬а ┬а ┬а {products.map(p=>(
┬а ┬а ┬а ┬а <div key={p.id} className="flex justify-between border-b py-1">
┬а ┬а ┬а ┬а ┬а {p.name} р╕┐{p.price}
┬а ┬а ┬а ┬а ┬а <button className="text-red-600" onClick={()=>onDel(p.id)}>Delete</button>
┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ))}
┬а ┬а </div>
┬а );
}

function ProductReviews({product, reviews, user, onClose, onAddReview}) {
┬а ┬а const [rating, setRating] = useState(0);
┬а ┬а const [comment, setComment] = useState('');

┬а ┬а const handleSubmit = () => {
┬а ┬а ┬а ┬а if (!user) {
┬а ┬а ┬а ┬а ┬а ┬а alert("р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Вр╕╡р╕вр╕Щр╕гр╕╡р╕зр╕┤р╕з");
┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а if (rating === 0) {
┬а ┬а ┬а ┬а ┬а ┬а alert("р╕Бр╕гр╕╕р╕Ур╕▓р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ");
┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а onAddReview(product.id, rating, comment);
┬а ┬а ┬а ┬а setRating(0);
┬а ┬а ┬а ┬а setComment('');
┬а ┬а };

┬а ┬а return (
┬а ┬а ┬а ┬а <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
┬а ┬а ┬а ┬а ┬а ┬а <div className="bg-white rounded-lg p-6 w-full max-w-lg relative">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button onClick={onClose} className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а &times;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 className="font-bold text-2xl mb-4">{product.name} Reviews</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div className="max-h-60 overflow-y-auto border-b pb-4 mb-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а {reviews.length > 0 ? (
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а reviews.map(r => (
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div key={r.id} className="border-t pt-2 mt-2 first:border-t-0">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div className="flex justify-between items-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span className="font-semibold text-amber-700">{r.user}</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span className="text-yellow-600">тнР {r.rating}</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p className="text-gray-600 mt-1">{r.comment}</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ))
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ) : (
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p className="text-gray-500 text-center">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕╡р╕зр╕┤р╕зр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Щр╕╡р╣Й</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а )}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h4 className="font-semibold text-lg mb-2">р╣Ар╕Вр╕╡р╕вр╕Щр╕гр╕╡р╕зр╕┤р╕зр╕Вр╕нр╕Зр╕Др╕╕р╕У</h4>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div className="mb-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label className="block text-gray-700">р╕Др╕░р╣Бр╕Щр╕Щ:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div className="flex gap-1">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а {[1, 2, 3, 4, 5].map(star => (
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а key={star}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onClick={() => setRating(star)}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а className={`text-2xl cursor-pointer ${rating >= star ? 'text-yellow-500' : 'text-gray-300'}`}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а >
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а тШЕ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ))}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div className="mb-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label className="block text-gray-700">р╕Др╕зр╕▓р╕бр╕Др╕┤р╕Фр╣Ар╕лр╣Зр╕Щ:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <textarea
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а value={comment}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onChange={(e) => setComment(e.target.value)}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а className="border p-2 w-full rounded"
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а rows="3"
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а placeholder="р╣Ар╕Вр╕╡р╕вр╕Щр╕Др╕зр╕▓р╕бр╕Др╕┤р╕Фр╣Ар╕лр╣Зр╕Щр╕Вр╕нр╕Зр╕Др╕╕р╕Ур╕Чр╕╡р╣Ир╕Щр╕╡р╣И..."
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ></textarea>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button onClick={handleSubmit} className="bg-amber-600 text-white px-4 py-2 rounded w-full">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕кр╣Ир╕Зр╕гр╕╡р╕зр╕┤р╕з
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </div>
┬а ┬а );
}

function PromptPayModal({ total, onClose, onConfirm }) {
    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-lg p-6 w-full max-w-sm relative text-center">
                <button onClick={onClose} className="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl">
                    &times;
                </button>
                <h3 className="font-bold text-lg mb-4">р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╕Ьр╣Ир╕▓р╕Щ PromptPay</h3>
                <p className="text-sm mb-2">р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ: <span className="font-bold text-lg">р╕┐{total}</span></p>
                <p className="text-gray-600 text-sm mb-4">
                    р╕кр╣Бр╕Бр╕Щ QR Code р╣Ар╕Юр╕╖р╣Ир╕нр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ (р╣Ар╕Ыр╣Зр╕Щр╕Бр╕▓р╕гр╕Ир╕│р╕ер╕нр╕З)
                </p>
                <img 
                    src="https://media.discordapp.net/attachments/782253048071716896/1418292732111098007/IMG_3422.jpg?ex=68cd9789&is=68cc4609&hm=0bf2fa9acf5a28c98fcb98f772bcf4975bfcced53845ff9025bbcd9f9cb25c0b&=&format=webp&width=742&height=1006" 
                    alt="PromptPay QR Code" 
                    className="w-full max-w-xs mx-auto mb-4 border rounded"
                />
                <button 
                    onClick={onConfirm}
                    className="bg-amber-600 text-white px-4 py-2 rounded w-full"
                >
                    р╕Ыр╕┤р╕Ф
                </button>
            </div>
        </div>
    );
}

// ---------------- Main App ------------------
function App(){
  const [page,setPage]=useLocal('page','home');
  const [products,setProducts]=useLocal('products',SAMPLE_PRODUCTS);
  const [cart,setCart]=useLocal('cart',[]);
  const [orders,setOrders]=useLocal('orders',[]);
  const [favs,setFavs]=useLocal('favs',[]);
  const [user,setUser]=useLocal('user',null);
  const [coupon,setCoupon]=useState('');
  const [cartOpen,setCartOpen]=useState(false);
  const [reviews, setReviews] = useLocal('reviews', SAMPLE_REVIEWS);
  const [reviewProduct, setReviewProduct] = useState(null);
  const [showPromptPayModal, setShowPromptPayModal] = useState(false);
  const [checkoutTotal, setCheckoutTotal] = useState(0);

  function addCart(p){
    setCart(c=>{
      const f=c.find(i=>i.id===p.id);
      return f?c.map(i=>i.id===p.id?{...i,qty:i.qty+1}:i):[...c,{...p,qty:1}];
    });
    setCartOpen(true);
  }

  const qtyUpdate=(id,q)=>setCart(c=>c.map(i=>i.id===id?{...i,qty:Math.max(1,q)}:i));
  const removeItem=id=>setCart(c=>c.filter(i=>i.id!==id));
  const toggleFav=id=>setFavs(f=>f.includes(id)?f.filter(x=>x!==id):[...f,id]);
  
  const handleCheckout=total=>{
    const method = prompt("Payment method (PromptPay/COD)?","PromptPay");
    if (method === 'PromptPay') {
      setCheckoutTotal(total);
      setShowPromptPayModal(true);
    } else {
      setOrders(o=>[{id:Date.now(),total,method:method||'PromptPay'},...o]);
      setCart([]);
      alert("Order placed!");
      setCartOpen(false);
      setPage('profile');
    }
  };

  const finalizeOrderAfterPromptPay = () => {
      setOrders(o=>[{id:Date.now(),total: checkoutTotal,method:'PromptPay'},...o]);
      setCart([]);
      setShowPromptPayModal(false);
      alert("Order placed!");
      setCartOpen(false);
      setPage('profile');
  };
  
  const cancelOrder = (orderId) => {
    if (window.confirm("р╕Др╕╕р╕Ур╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕нр╕нр╣Ар╕Фр╕нр╕гр╣Мр╕Щр╕╡р╣Йр╣Гр╕Кр╣Ир╣Др╕лр╕б?")) {
      setOrders(currentOrders => currentOrders.filter(o => o.id !== orderId));
      alert("р╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕нр╕нр╣Ар╕Фр╕нр╕гр╣Мр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з");
    }
  };

  const addReview = (productId, rating, comment) => {
      const newReview = {
          id: Date.now().toString(),
          productId,
          rating,
          comment,
          user: user
      };
      setReviews(prevReviews => [...prevReviews, newReview]);
      const productToUpdate = products.find(p => p.id === productId);
      if (productToUpdate) {
          const allRatings = [...reviews.filter(r => r.productId === productId).map(r => r.rating), rating];
          const newAvgRating = allRatings.reduce((sum, r) => sum + r, 0) / allRatings.length;
          setProducts(prevProducts => prevProducts.map(p =>
              p.id === productId ? { ...p, rating: newAvgRating } : p
          ));
      }
      alert("р╕гр╕╡р╕зр╕┤р╕зр╕Вр╕нр╕Зр╕Др╕╕р╕Ур╕Цр╕╣р╕Бр╕кр╣Ир╕Зр╣Бр╕ер╣Йр╕з");
  };

  if(!user){
    const name = prompt("р╣Гр╕кр╣Ир╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕│р╕ер╕нр╕Зр╕Бр╕▓р╕гр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ");
    if(name) setUser(name);
  }

  return (
    <div className="min-h-screen p-4 max-w-6xl mx-auto">
      <Header cartCount={cart.reduce((s,i)=>s+i.qty,0)} user={user} onNav={setPage} onCart={()=>setCartOpen(true)}/>
      {page==='home' && <Home products={products} onAdd={addCart} onFav={toggleFav} favs={favs} onReview={setReviewProduct} />}
      {page==='menu' && <Menu products={products} onAdd={addCart} onFav={toggleFav} favs={favs} onReview={setReviewProduct}/>}
      {page==='profile' && <Profile orders={orders} favs={favs} onCancelOrder={cancelOrder}/>}
      {page==='admin' && <Admin products={products} onAdd={p=>setProducts(ps=>[...ps,p])} onDel={id=>setProducts(ps=>ps.filter(x=>x.id!==id))}/>}
      {cartOpen && <Cart items={cart} onQty={qtyUpdate} onRemove={removeItem} onCheckout={handleCheckout}
                        coupon={coupon} onCoupon={setCoupon} onClose={()=>setCartOpen(false)}/>}
      {reviewProduct && (
          <ProductReviews
              product={reviewProduct}
              reviews={reviews.filter(r => r.productId === reviewProduct.id)}
              user={user}
              onClose={() => setReviewProduct(null)}
              onAddReview={addReview}
          />
      )}
      {showPromptPayModal && (
          <PromptPayModal
              total={checkoutTotal}
              onClose={() => setShowPromptPayModal(false)}
              onConfirm={finalizeOrderAfterPromptPay}
          />
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
