<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bakery Moon Sweet</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-amber-50">
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect} = React;

function useLocal(key,init){
  const [val,setVal]=useState(()=>JSON.parse(localStorage.getItem(key)||'null')??init);
  useEffect(()=>localStorage.setItem(key,JSON.stringify(val)),[key,val]);
  return [val,setVal];
}

// ---------------- MOCK DATA -----------------
const SAMPLE_PRODUCTS = [
  {id:'1',name:'‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï',price:120,category:'‡πÄ‡∏Ñ‡πâ‡∏Å',desc:'‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ô‡∏∏‡πà‡∏°‡∏ä‡∏∏‡πà‡∏°‡∏â‡πà‡∏≥',rating:0, image:'https://image.makewebcdn.com/makeweb/m_1920x0/I1MJQjJJO/Cake/S__14204991.jpg'},
  {id:'2',name:'‡πÄ‡∏Ñ‡πâ‡∏Å‡∏™‡πâ‡∏°',price:100,category:'‡πÄ‡∏Ñ‡πâ‡∏Å',desc:'‡πÄ‡∏Ñ‡πâ‡∏Å‡∏™‡πâ‡∏°‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô ‡∏´‡∏ß‡∏≤‡∏ô‡∏≠‡∏°‡πÄ‡∏õ‡∏£‡∏µ‡πâ‡∏¢‡∏ß',rating:0, image:'https://api2.krua.co/wp-content/uploads/2025/01/SEO-1200x630-12.jpg'},
  {id:'3',name:'‡∏ó‡∏≤‡∏£‡πå‡∏ï‡πÑ‡∏Ç‡πà',price:45,category:'‡∏û‡∏≤‡∏¢/‡∏ó‡∏≤‡∏£‡πå‡∏ï',desc:'‡∏ó‡∏≤‡∏£‡πå‡∏ï‡πÑ‡∏Ç‡πà‡∏´‡∏≠‡∏°‡∏´‡∏ß‡∏≤‡∏ô ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ô‡∏∏‡πà‡∏°‡∏•‡∏∞‡∏°‡∏∏‡∏ô',rating:0, image:'https://www.sgethai.com/wp-content/uploads/2021/09/eggtart004.webp'},
  {id:'4',name:'‡∏û‡∏≤‡∏¢‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•',price:65,category:'‡∏û‡∏≤‡∏¢/‡∏ó‡∏≤‡∏£‡πå‡∏ï',desc:'‡∏û‡∏≤‡∏¢‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•‡∏Å‡∏£‡∏≠‡∏ö‡∏ô‡∏≠‡∏Å‡∏ô‡∏∏‡πà‡∏°‡πÉ‡∏ô ‡πÑ‡∏™‡πâ‡πÅ‡∏ô‡πà‡∏ô',rating:0, image:'https://img.kapook.com/u/2018/surauch/cooking/co1/apple.jpg'},
  {id:'5',name:'‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ‡πÄ‡∏ô‡∏¢‡∏™‡∏î',price:40,category:'‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ',desc:'‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ‡πÄ‡∏ô‡∏¢‡∏™‡∏î‡∏´‡∏≠‡∏°‡πÜ ‡∏Å‡∏£‡∏≠‡∏ö‡∏≠‡∏£‡πà‡∏≠‡∏¢',rating:0, image:'https://www.sgethai.com/wp-content/uploads/2022/06/Image09-3.webp'},
  {id:'6',name:'‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÑ‡∏™‡πâ‡∏´‡∏°‡∏π‡∏´‡∏¢‡∏≠‡∏á',price:35,category:'‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á',desc:'‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡∏Å‡∏±‡∏ö‡∏´‡∏°‡∏π‡∏´‡∏¢‡∏≠‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏≥',rating:0, image:'https://snackboxbypanleebakery.wordpress.com/wp-content/uploads/2018/07/dsc9812-2.jpg'},
  {id:'7',name:'‡∏ó‡∏≠‡∏ü‡∏ü‡∏µ‡πà‡πÄ‡∏Ñ‡πâ‡∏Å‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Å',price:90,category:'‡πÄ‡∏Ñ‡πâ‡∏Å',desc:'‡∏ó‡∏≠‡∏ü‡∏ü‡∏µ‡πà‡πÄ‡∏Ñ‡πâ‡∏Å‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Å ‡∏´‡∏ß‡∏≤‡∏ô‡∏°‡∏±‡∏ô',rating:0, image:'https://s359.kapook.com/pagebuilder/cad7feed-8b68-4c1e-b001-e25e575c8b7e.jpg'},
  {id:'8',name:'‡πÅ‡∏Æ‡∏°‡∏ä‡∏µ‡∏™',price:55,category:'‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á',desc:'‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏≠‡∏ö‡∏ä‡∏µ‡∏™‡∏¢‡∏∑‡∏î‡πÜ ‡∏Å‡∏±‡∏ö‡πÅ‡∏Æ‡∏°‡πÅ‡∏™‡∏ô‡∏≠‡∏£‡πà‡∏≠‡∏¢',rating:0, image:'https://www.pholfoodmafia.com/wp-content/uploads/2020/11/5Grilled-HamCheese-Sandwiches.jpg'},
  {id:'9',name:'‡πÇ‡∏î‡∏ô‡∏±‡∏ó‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•',price:25,category:'‡πÇ‡∏î‡∏ô‡∏±‡∏ó',desc:'‡πÇ‡∏î‡∏ô‡∏±‡∏ó‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ô‡∏∏‡πà‡∏° ‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ö‡∏≤‡∏á‡πÜ',rating:0, image:'https://preview.redd.it/donuts-might-be-the-most-glazed-ever-v0-zhtrwe2ks2ve1.jpeg?width=640&crop=smart&auto=webp&s=f089bd955092d42abe48e1d5e99cbc2771bc7e3d'},
  {id:'10',name:'‡πÇ‡∏î‡∏ô‡∏±‡∏ó‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï',price:30,category:'‡πÇ‡∏î‡∏ô‡∏±‡∏ó',desc:'‡πÇ‡∏î‡∏ô‡∏±‡∏ó‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡πÇ‡∏£‡∏¢‡πÄ‡∏Å‡∏•‡πá‡∏î‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•',rating:0, image:'https://prettysimplesweet.com/wp-content/uploads/2019/07/Chocolate-Donuts.jpg'}
];

const SAMPLE_REVIEWS = [];

// --------------- Components -----------------
function Header({cartCount,user,onNav,onCart,isAdmin,onLogout}){
  return (
    <header className="bg-amber-100 border-b p-4 flex justify-between items-center">
      <h1 className="font-bold text-xl">Bakery Moon Sweet</h1>
      <div className="flex gap-4 items-center">
        <button onClick={()=>onNav('home')}>Home</button>
        <button onClick={()=>onNav('menu')}>Menu</button>
        <button onClick={()=>onNav('profile')}>Profile</button>
        {isAdmin && <button onClick={()=>onNav('admin')}>Admin</button>}
        <button className="bg-amber-600 text-white px-3 py-1 rounded" onClick={onCart}>Cart ({cartCount})</button>
        <span className="text-sm text-gray-700">{user ? `Hi, ${user}` : ''}</span>
        {user && <button onClick={onLogout} className="text-sm underline text-red-500">Log out</button>}
      </div>
    </header>
  );
}

function SearchBar({onChange}){
  return (
    <input
      className="border p-2 w-full rounded mb-4"
      placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."
      onChange={e=>onChange(e.target.value)}
    />
  );
}

function ProductCard({p,onAdd,onFav,favs,onReview}){
  const fav = favs.includes(p.id);
  const ratingDisplay = p.rating > 0 ? p.rating.toFixed(1) : p.rating;
  return (
    <div className="border rounded-lg p-4 flex flex-col shadow-sm hover:shadow-lg transition-shadow bg-white">
      {p.image && <img src={p.image} alt={p.name} className="w-full h-32 object-cover rounded-md mb-2"/>}
      <div className="flex justify-between">
        <div className="font-semibold text-lg">{p.name}</div>
        <button onClick={()=>onFav(p.id)}>{fav?'‚ù§Ô∏è':'ü§ç'}</button>
      </div>
      <div className="text-xs text-gray-600">{p.category}</div>
      <div className="mt-1 text-sm">{p.desc}</div>
      <div className="mt-1 text-yellow-600 text-sm">‚≠ê {ratingDisplay}</div>
      <div className="flex justify-between mt-3 items-center">
        <div className="font-bold text-lg">‡∏ø{p.price}</div>
        <button onClick={()=>onAdd(p)} className="bg-amber-600 text-white px-2 py-1 rounded">Add</button>
      </div>
      <button onClick={()=>onReview(p)} className="text-xs mt-1 underline">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
    </div>
  );
}

function Home({products, onAdd, onFav, favs, onReview}) {
    const featured = products.slice(0, 4);
    return (
        <div className="p-4">
            <div className="relative h-64 bg-cover bg-center rounded-lg shadow-lg" style={{backgroundImage: "url('https://i.imgur.com/GzW7w8L.png')"}}>
                <div className="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center rounded-lg">
                    <h2 className="text-white text-4xl font-bold drop-shadow-lg text-center">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Bakery Moon Sweet</h2>
                </div>
            </div>

            <div className="mt-8">
                <h3 className="font-bold text-2xl mb-4 text-center text-amber-800">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
                <div className="grid md:grid-cols-4 gap-4">
                    {featured.map(p => <ProductCard key={p.id} p={p} onAdd={onAdd} onFav={onFav} favs={favs} onReview={onReview}/>)}
                </div>
            </div>

            <div className="mt-8 bg-amber-200 p-6 rounded-lg shadow-md text-center">
                <h3 className="font-bold text-2xl text-amber-800">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©!</h3>
                <p className="mt-2 text-amber-700 text-lg">‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö 500 ‡∏ö‡∏≤‡∏ó</p>
                <p className="font-semibold text-amber-900 mt-1">‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î: SWEET10</p>
            </div>
            
            <div className="mt-8 text-center text-gray-700">
                <h3 className="font-bold text-2xl text-amber-800">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</h3>
                <p className="mt-2 text-lg">
                    ‡πÄ‡∏£‡∏≤‡∏≠‡∏ö‡∏Ç‡∏ô‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏™‡πà‡πÉ‡∏à‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
                    ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏´‡∏≠‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ô‡∏∏‡πà‡∏°‡∏•‡∏∞‡∏°‡∏∏‡∏ô
                    ‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏µ‡πÜ ‡∏Å‡∏±‡∏ö‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏™‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞!
                </p>
            </div>
        </div>
    );
}

function Menu({products,onAdd,onFav,favs,onReview}){
  const [filter,setFilter]=useState('');
  const [search,setSearch]=useState('');
  const cats=['All',...new Set(products.map(p=>p.category))];
  const shown = products.filter(p=>
    (filter===''||filter==='All'||p.category===filter) &&
    p.name.toLowerCase().includes(search.toLowerCase())
  );
  return (
    <div className="p-4">
      <SearchBar onChange={setSearch}/>
      <select value={filter} onChange={e=>setFilter(e.target.value)} className="border p-1 mb-4">
        {cats.map(c=><option key={c}>{c}</option>)}
      </select>
      <div className="grid md:grid-cols-3 gap-4">
        {shown.map(p=><ProductCard key={p.id} p={p} onAdd={onAdd} onFav={onFav} favs={favs} onReview={onReview}/>)}
      </div>
    </div>
  );
}

function Cart({items,onQty,onRemove,onCheckout,coupon,onCoupon,onClose}){
  const subtotal = items.reduce((s,i)=>s+i.price*i.qty,0);
  const discount = coupon==='BAKE10'? subtotal*0.1 : 0;
  const total = subtotal - discount;
  return (
    <div className="fixed top-20 right-4 w-80 bg-white border p-4 rounded shadow z-50">
      <div className="flex justify-between mb-2">
        <h3 className="font-semibold">Cart</h3>
        <button onClick={onClose}>X</button>
      </div>
      {items.map(i=>
        <div key={i.id} className="flex justify-between mb-2">
          <span>{i.name}</span>
          <div className="flex gap-1 items-center">
            <button onClick={()=>onQty(i.id,i.qty-1)}>-</button>
            {i.qty}
            <button onClick={()=>onQty(i.id,i.qty+1)}>+</button>
            <button onClick={()=>onRemove(i.id)} className="text-red-500">x</button>
          </div>
        </div>
      )}
      <input className="border p-1 w-full mb-2" placeholder="‡πÉ‡∏™‡πà‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á" value={coupon} onChange={e=>onCoupon(e.target.value)}/>
      <div>Subtotal: ‡∏ø{subtotal}</div>
      {discount>0 && <div className="text-green-600">Discount: -‡∏ø{discount}</div>}
      <div className="font-bold">Total: ‡∏ø{total}</div>
      <button className="w-full bg-amber-600 text-white py-1 mt-2 rounded" onClick={()=>onCheckout(total)}>Checkout</button>
    </div>
  );
}

function ShippingForm({onConfirm, onClose}) {
  const [name, setName] = useState('');
  const [address, setAddress] = useState('');
  const [phone, setPhone] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    if (name && address && phone) {
      onConfirm({ name, address, phone });
    } else {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-lg p-6 w-full max-w-md relative">
        <button onClick={onClose} className="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl">
          &times;
        </button>
        <h3 className="font-bold text-lg mb-4 text-center">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h3>
        <form onSubmit={handleSubmit} className="flex flex-col gap-3">
          <input
            className="border p-2 rounded w-full"
            placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
            value={name}
            onChange={e => setName(e.target.value)}
          />
          <textarea
            className="border p-2 rounded w-full"
            placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà"
            value={address}
            onChange={e => setAddress(e.target.value)}
            rows="4"
          />
          <input
            className="border p-2 rounded w-full"
            placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå"
            value={phone}
            onChange={e => setPhone(e.target.value)}
          />
          <button type="submit" className="bg-amber-600 text-white py-2 rounded mt-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        </form>
      </div>
    </div>
  );
}

function Profile({orders,favs, onCancelOrder, onComplaint}){
  return (
    <div className="p-4">
      <h2 className="font-bold text-lg mb-2">Profile</h2>
      <h3 className="font-semibold mt-2">Favorites</h3>
      <ul className="list-disc ml-5">
        {favs.length?favs.map(f=><li key={f}>{f}</li>):<li>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</li>}
      </ul>
      <h3 className="font-semibold mt-4">Orders</h3>
      {orders.length===0 && <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>}
      {orders.map(o=>(
        <div key={o.id} className="border p-2 my-1 flex justify-between items-center">
          <div>
            <div>#{o.id} ‚Ä¢ ‡∏ø{o.total} ‚Ä¢ {o.method}</div>
            <div className="text-sm text-gray-500">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</div>
            {o.shipping && (
                <div className="text-xs text-gray-400 mt-1">
                    ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á: {o.shipping.name} ({o.shipping.phone})<br/>
                    ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: {o.shipping.address}
                </div>
            )}
          </div>
          <div className="flex gap-2">
            <button
              onClick={() => onComplaint(o.id)}
              className="bg-red-500 text-white text-xs px-2 py-1 rounded hover:bg-red-600"
            >
              üö® ‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </button>
            <button
              onClick={() => onCancelOrder(o.id)}
              className="bg-gray-500 text-white text-xs px-2 py-1 rounded hover:bg-gray-600"
            >
              ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
          </div>
        </div>
      ))}
    </div>
  );
}

function Admin({products,onAdd,onDel}){
  const [form,setForm]=useState({name:'',price:'',category:'',desc:''});
  return (
    <div className="p-4">
      <h2 className="font-bold text-lg mb-2">Admin Panel</h2>
      <div className="border p-3 mb-4 rounded">
        <input className="border p-1 mr-1" placeholder="Name" value={form.name} onChange={e=>setForm({...form,name:e.target.value})}/>
        <input className="border p-1 mr-1 w-20" placeholder="Price" value={form.price} onChange={e=>setForm({...form,price:Number(form.price)})}/>
        <input className="border p-1 mr-1" placeholder="Category" value={form.category} onChange={e=>setForm({...form,category:e.target.value})}/>
        <input className="border p-1 mr-1" placeholder="Desc" value={form.desc} onChange={e=>setForm({...form,desc:e.target.value})}/>
        <button className="bg-green-500 text-white px-2 py-1 rounded" onClick={()=>{
          if(form.name&&form.price){
            onAdd({...form,price:Number(form.price),id:Date.now().toString(),rating:0});
            setForm({name:'',price:'',category:'',desc:''});
          }
        }}>Add</button>
      </div>
      <h3 className="font-semibold">Current Products</h3>
      {products.map(p=>(
        <div key={p.id} className="flex justify-between border-b py-1">
          {p.name} ‡∏ø{p.price}
          <button className="text-red-600" onClick={()=>onDel(p.id)}>Delete</button>
        </div>
      ))}
    </div>
  );
}

function ProductReviews({product, reviews, user, onClose, onAddReview}) {
    const [rating, setRating] = useState(0);
    const [comment, setComment] = useState('');

    const handleSubmit = () => {
        if (!user) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß");
            return;
        }
        if (rating === 0) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô");
            return;
        }
        onAddReview(product.id, rating, comment);
        setRating(0);
        setComment('');
    };

    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-lg p-6 w-full max-w-lg relative">
                <button onClick={onClose} className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl">
                    &times;
                </button>
                <h3 className="font-bold text-2xl mb-4">{product.name} Reviews</h3>
                
                <div className="max-h-60 overflow-y-auto border-b pb-4 mb-4">
                    {reviews.length > 0 ? (
                        reviews.map(r => (
                            <div key={r.id} className="border-t pt-2 mt-2 first:border-t-0">
                                <div className="flex justify-between items-center">
                                    <span className="font-semibold text-amber-700">{r.user}</span>
                                    <span className="text-yellow-600">‚≠ê {r.rating}</span>
                                </div>
                                <p className="text-gray-600 mt-1">{r.comment}</p>
                            </div>
                        ))
                    ) : (
                        <p className="text-gray-500 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ</p>
                    )}
                </div>

                <h4 className="font-semibold text-lg mb-2">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h4>
                <div className="mb-2">
                    <label className="block text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</label>
                    <div className="flex gap-1">
                        {[1, 2, 3, 4, 5].map(star => (
                            <span
                                key={star}
                                onClick={() => setRating(star)}
                                className={`text-2xl cursor-pointer ${rating >= star ? 'text-yellow-500' : 'text-gray-300'}`}
                            >
                                ‚òÖ
                            </span>
                        ))}
                    </div>
                </div>
                <div className="mb-4">
                    <label className="block text-gray-700">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô:</label>
                    <textarea
                        value={comment}
                        onChange={(e) => setComment(e.target.value)}
                        className="border p-2 w-full rounded"
                        rows="3"
                        placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
                    ></textarea>
                </div>
                <button onClick={handleSubmit} className="bg-amber-600 text-white px-4 py-2 rounded w-full">
                    ‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
                </button>
            </div>
        </div>
    );
}

function PromptPayModal({ total, onClose, onConfirm }) {
    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-lg p-6 w-full max-w-sm relative text-center">
                <button onClick={onClose} className="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl">
                    &times;
                </button>
                <h3 className="font-bold text-lg mb-4">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô PromptPay</h3>
                <p className="text-sm mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: <span className="font-bold text-lg">‡∏ø{total}</span></p>
                <p className="text-gray-600 text-sm mb-4">
                    ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á)
                </p>
                <img 
                    src="https://i.imgur.com/7S81T6d.jpg" 
                    alt="PromptPay QR Code" 
                    className="w-full max-w-xs mx-auto mb-4 border rounded"
                />
                <button 
                    onClick={onConfirm}
                    className="bg-amber-600 text-white px-4 py-2 rounded w-full"
                >
                    ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    );
}

// ---------------- Main App ------------------
function App(){
  const [page,setPage]=useLocal('page','home');
  const [products,setProducts]=useState(SAMPLE_PRODUCTS);
  const [cart,setCart]=useLocal('cart',[]);
  const [orders,setOrders]=useLocal('orders',[]);
  const [favs,setFavs]=useLocal('favs',[]);
  const [user,setUser]=useLocal('user',null);
  const [coupon,setCoupon]=useState('');
  const [cartOpen,setCartOpen]=useLocal('cartOpen',false);
  const [reviews, setReviews] = useState(SAMPLE_REVIEWS);
  const [reviewProduct, setReviewProduct] = useState(null);
  const [showPromptPayModal, setShowPromptPayModal] = useState(false);
  const [checkoutTotal, setCheckoutTotal] = useState(0);
  const [showShippingForm, setShowShippingForm] = useState(false);

  const isUserAdmin = () => user === 'admin';

  function addCart(p){
    setCart(c=>{
      const f=c.find(i=>i.id===p.id);
      return f?c.map(i=>i.id===p.id?{...i,qty:i.qty+1}:i):[...c,{...p,qty:1}];
    });
    setCartOpen(true);
  }

  const qtyUpdate=(id,q)=>setCart(c=>c.map(i=>i.id===id?{...i,qty:Math.max(1,q)}:i));
  const removeItem=id=>setCart(c=>c.filter(i=>i.id!==id));
  const toggleFav=id=>setFavs(f=>f.includes(id)?f.filter(x=>x!==id):[...f,id]);
  
  const handleCheckout=total=>{
    setCheckoutTotal(total);
    setShowShippingForm(true);
  };
  
  const handleShippingConfirm = (shippingDetails) => {
      setShowShippingForm(false);
      const method = prompt("Payment method (PromptPay/COD)?","PromptPay");
      if (method === 'PromptPay') {
          setShowPromptPayModal(true);
      } else {
          setOrders(o=>[{id:Date.now(),total: checkoutTotal,method:method||'COD', shipping: shippingDetails},...o]);
          setCart([]);
          alert("Order placed!");
          setCartOpen(false);
          setPage('profile');
      }
  };

  const finalizeOrderAfterPromptPay = () => {
      setOrders(o=>[{id:Date.now(),total: checkoutTotal,method:'PromptPay', shipping: null},...o]);
      setCart([]);
      setShowPromptPayModal(false);
      alert("Order placed!");
      setCartOpen(false);
      setPage('profile');
  };
  
  const cancelOrder = (orderId) => {
    if (window.confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) {
      setOrders(currentOrders => currentOrders.filter(o => o.id !== orderId));
      alert("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    }
  };

  const handleComplaint = (orderId) => {
    const reason = prompt("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #" + orderId + ":");
    if (reason) {
      alert("‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏£‡∏µ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞");
      // ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á server ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π
    }
  };

  const addReview = (productId, rating, comment) => {
      const newReview = {
          id: Date.now().toString(),
          productId,
          rating,
          comment,
          user: user
      };
      setReviews(prevReviews => [...prevReviews, newReview]);
      const productToUpdate = products.find(p => p.id === productId);
      if (productToUpdate) {
          const allRatings = [...reviews.filter(r => r.productId === productId).map(r => r.rating), rating];
          const newAvgRating = allRatings.reduce((sum, r) => sum + r, 0) / allRatings.length;
          setProducts(prevProducts => prevProducts.map(p =>
              p.id === productId ? { ...p, rating: newAvgRating } : p
          ));
      }
      alert("‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß");
  };

  const handleLogout = () => {
      setUser(null);
      setPage('home');
  };

  if(!user){
    const name = prompt("‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô");
    if(name) setUser(name);
  }

  return (
    <div className="min-h-screen p-4 max-w-6xl mx-auto">
      <Header 
        cartCount={cart.reduce((s,i)=>s+i.qty,0)} 
        user={user} 
        onNav={setPage} 
        onCart={()=>setCartOpen(true)} 
        isAdmin={isUserAdmin()} 
        onLogout={handleLogout}
      />
      {page==='home' && <Home products={products} onAdd={addCart} onFav={toggleFav} favs={favs} onReview={setReviewProduct} />}
      {page==='menu' && <Menu products={products} onAdd={addCart} onFav={toggleFav} favs={favs} onReview={setReviewProduct}/>}
      {page==='profile' && <Profile orders={orders} favs={favs} onCancelOrder={cancelOrder} onComplaint={handleComplaint}/>}
      {page==='admin' && isUserAdmin() && <Admin products={products} onAdd={p=>setProducts(ps=>[...ps,p])} onDel={id=>setProducts(ps=>ps.filter(x=>x.id!==id))}/>}
      {page==='admin' && !isUserAdmin() && <div className="p-4 text-center text-red-500 font-bold">‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</div>}
      {cartOpen && <Cart items={cart} onQty={qtyUpdate} onRemove={removeItem} onCheckout={handleCheckout}
                        coupon={coupon} onCoupon={setCoupon} onClose={()=>setCartOpen(false)}/>}
      {showShippingForm && <ShippingForm onConfirm={handleShippingConfirm} onClose={()=>setShowShippingForm(false)}/>}
      {reviewProduct && (
          <ProductReviews
              product={reviewProduct}
              reviews={reviews.filter(r => r.productId === reviewProduct.id)}
              user={user}
              onClose={() => setReviewProduct(null)}
              onAddReview={addReview}
          />
      )}
      {showPromptPayModal && (
          <PromptPayModal
              total={checkoutTotal}
              onClose={() => setShowPromptPayModal(false)}
              onConfirm={finalizeOrderAfterPromptPay}
          />
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
